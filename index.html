<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>DDNS IP Lookup — appleton.ddns.net</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0b1420; --card:#121c2a; --ink:#e6edf3; --muted:#9fb0c3; --accent:#4da3ff; }
    html,body { height:100%; margin:0; }
    body {
      background: var(--bg);
      color: var(--ink);
      font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 28px;
      max-width: 720px;
      width: 100%;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    h1 { margin: 0 0 6px; font-size: 20px; font-weight: 600; }
    p { margin: 8px 0; color: var(--muted); }
    .value { font-size: 32px; font-weight: 700; margin: 6px 0 2px; word-break: break-all; }
    .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    .btn {
      appearance:none; border:0; border-radius: 10px; padding:10px 14px;
      background: var(--accent); color:#031a2b; font-weight:700; cursor:pointer;
    }
    .btn.secondary { background:#223043; color: var(--ink); }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .ok { color: #48e078; }
    .err { color: #ff7a7a; }
    .small { font-size: 12px; }
  </style>
</head>
<body>
  <main class="card">
    <h1>Current IP for <span class="mono">appleton.ddns.net</span></h1>
    <div id="status" class="small">Loading…</div>

    <div id="ip" class="value mono">—</div>
    <div id="updated" class="small">—</div>

    <div class="row" style="margin-top:12px;">
      <a id="open" class="btn" href="#" target="_blank" rel="noopener">Open :8096</a>
      <button id="copy" class="btn secondary">Copy IP</button>
    </div>

    <p class="small" style="margin-top:16px;">
      Data is written by a GitHub Action to <span class="mono">ip.json</span> in this repo.
    </p>
  </main>

  <script>
    const els = {
      status: document.getElementById('status'),
      ip: document.getElementById('ip'),
      updated: document.getElementById('updated'),
      open: document.getElementById('open'),
      copy: document.getElementById('copy'),
    };

    function setStatus(msg, cls) {
      els.status.textContent = msg;
      els.status.className = 'small ' + (cls || '');
    }

    function ipToUrl(ip) {
      if (!ip) return '#';
      return ip.includes(':') ? `http://[${ip}]:8096/` : `http://${ip}:8096/`;
    }

    async function load() {
      try {
        const res = await fetch(`ip.json?ts=${Date.now()}`, { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        const ip = data.ip || '';
        const when = data.resolved_at_utc || '';
        els.ip.textContent = ip || 'No IP found';
        els.updated.textContent = when ? `Last updated: ${when} UTC` : '';
        els.open.href = data.url || ipToUrl(ip);

        if (ip) setStatus('OK', 'ok'); else setStatus('No IP in JSON', 'err');
      } catch (e) {
        setStatus('Failed to load ip.json: ' + e.message, 'err');
        els.ip.textContent = '—';
        els.updated.textContent = '';
        els.open.href = '#';
      }
    }

    els.copy.addEventListener('click', async () => {
      const text = els.ip.textContent.trim();
      if (!text || text === '—') return;
      try { await navigator.clipboard.writeText(text); setStatus('Copied!', 'ok'); }
      catch { setStatus('Copy failed', 'err'); }
    });

    load();
  </script>
</body>
</html>
